(function(a){if(typeof define==="function"&&define.amd){define(["JSRootPainter","d3"],a)}else{if(typeof exports==="object"&&typeof module!=="undefined"){a(require("./JSRootCore.js"),require("./d3.min.js"))}else{if(typeof d3!="object"){throw new Error("This extension requires d3.js","JSRootPainter.v7hist.js")}if(typeof JSROOT=="undefined"){throw new Error("JSROOT is not defined","JSRootPainter.v7hist.js")}if(typeof JSROOT.Painter!="object"){throw new Error("JSROOT.Painter not defined","JSRootPainter.v7hist.js")}a(JSROOT,d3)}}}(function(a,b){a.sources.push("v7hist");function e(h){a.TObjectPainter.call(this,h);this.draw_content=true;this.nbinsx=0;this.nbinsy=0;this.accept_drops=true;this.mode3d=false;this.zoom_changed_interactive=0}e.prototype=Object.create(a.TObjectPainter.prototype);e.prototype.PrepareFrame=function(h){this.SetDivId(h,-1);if(!this.frame_painter()){a.v7.drawFrame(h,null)}this.SetDivId(h)};e.prototype.GetHisto=function(){var i=this.GetObject(),h=null;if(i&&i.fHistImpl){h=i.fHistImpl.fIsWeak?i.fHistImpl.fWeakForIO:i.fHistImpl.fUnique}if(h&&!h.getBinContent){if(h.fAxes._1){h.getBin=function(j,k){return(j+this.fAxes._0.fNBins*k)};h.getBinContent=function(j,k){return this.fStatistics.fBinContent[this.getBin(j,k)]};h.getBinError=function(j,l){var k=this.getBin(j,l);if(this.fStatistics.fSumWeightsSquared){return Math.sqrt(this.fStatistics.fSumWeightsSquared[k])}return Math.sqrt(Math.abs(this.fStatistics.fBinContent[k]))}}else{h.getBinContent=function(j){return this.fStatistics.fBinContent[j]};h.getBinError=function(j){if(this.fStatistics.fSumWeightsSquared){return Math.sqrt(this.fStatistics.fSumWeightsSquared[j])}return Math.sqrt(Math.abs(this.getBinContent(j)))}}}return h};e.prototype.IsTProfile=function(){return false};e.prototype.IsTH1K=function(){return false};e.prototype.IsTH2Poly=function(){return false};e.prototype.DecodeOptions=function(h){if(!this.options){this.options={Hist:1}}};e.prototype.Clear3DScene=function(){var h=this.frame_painter();if(h&&typeof h.Create3DScene==="function"){h.Create3DScene(-1)}this.mode3d=false};e.prototype.Cleanup=function(){this.Clear3DScene();delete this.fPalette;delete this.fContour;delete this.options;a.TObjectPainter.prototype.Cleanup.call(this)};e.prototype.Dimension=function(){return 1};e.prototype.GetAutoColor=function(h){if(this.options.AutoColor<=0){return h}var i=this.options.AutoColor;this.options.AutoColor=i%8+1;return a.Painter.root_colors[i]};e.prototype.ScanContent=function(h){alert("HistPainter.prototype.ScanContent not implemented")};e.prototype.DrawAxes=function(){var h=this.frame_painter();if(!h){return false}if(this.draw_content){h.SetAxesRanges(this.xmin,this.xmax,this.ymin,this.ymax)}return h.DrawAxes(true)};e.prototype.CheckHistDrawAttributes=function(){var i=this.GetObject().fOpts,h=this.canv_painter();this.createAttFill({pattern:0,color:0});var j=h.GetNewColor(i.fLineColor);this.createAttLine({color:j||"black"})};e.prototype.UpdateObject=function(j,i){var h=this.GetObject();if(j!==h){if(!this.MatchObjectType(j)){return false}}this.ScanContent();this.histogram_updated=true;return true};e.prototype.GetAxis=function(i){var h=this.GetHisto();if(!h||!h.fAxes){return null}var j=h.fAxes._0;switch(i){case"x":j=h.fAxes._0;break;case"y":j=h.fAxes._1;break;case"z":j=h.fAxes._2;break}if(!j||j.GetBinCoord){return j}if(j._typename=="ROOT::Experimental::TAxisEquidistant"){j.min=j.fLow;j.max=j.fLow+(j.fNBins-2)/j.fInvBinWidth;j.GetBinCoord=function(k){return this.fLow+k/this.fInvBinWidth};j.FindBin=function(k,l){return Math.floor((k-this.fLow)*this.fInvBinWidth+l)}}else{j.min=j.fBinBorders[0];j.max=j.fBinBorders[j.fNBins-2];j.GetBinCoord=function(l){var m=Math.round(l);if(m<=0){return this.fBinBorders[0]}if(m>this.fNBins-2){return this.fBinBorders[this.fNBins-2]}if(m==l){return this.fBinBorders[m]}var k=(l<m)?m-1:m+1;return this.fBinBorders[m]*Math.abs(l-k)+this.fBinBorders[k]*Math.abs(l-m)};j.FindBin=function(l,o){for(var m=1;m<this.fBinBorders.length;++m){if(l<this.fBinBorders[m]){return Math.floor(m-1+o)}}return this.fNBins-2}}return j};e.prototype.CreateAxisFuncs=function(k,j){var h=this.GetHisto();if(!h){return}var i=this.GetAxis("x");this.xmin=i.min;this.xmax=i.max;if(!k||!this.nbinsy){return}i=this.GetAxis("y");this.ymin=i.min;this.ymax=i.max;if(!j||!this.nbinsz){return}i=this.GetAxis("z");this.zmin=i.min;this.zmax=i.max};e.prototype.DrawBins=function(){alert("HistPainter.DrawBins not implemented")};e.prototype.ToggleTitle=function(h){return false};e.prototype.DecomposeTitle=function(){};e.prototype.DrawTitle=function(){};e.prototype.UpdateStatWebCanvas=function(){};e.prototype.ToggleStat=function(h){};e.prototype.GetSelectIndex=function(i,q,p){var m=0,j=this.frame_painter(),h=this.GetAxis(i),l=this["nbins"+i]||0,k=j?j["zoom_"+i+"min"]:0,o=j?j["zoom_"+i+"max"]:0;if((k!==o)&&h){if(q=="left"){m=h.FindBin(k,p||0)}else{m=h.FindBin(o,(p||0)+0.5)}if(m<0){m=0}else{if(m>l){m=l}}}else{m=(q=="left")?0:l}return m};e.prototype.FindStat=function(){return null};e.prototype.IgnoreStatsFill=function(){return true};e.prototype.CreateStat=function(h){return null};e.prototype.ButtonClick=function(h){switch(h){case"ToggleZoom":if((this.zoom_xmin!==this.zoom_xmax)||(this.zoom_ymin!==this.zoom_ymax)||(this.zoom_zmin!==this.zoom_zmax)){this.Unzoom();return true}if(this.draw_content&&(typeof this.AutoZoom==="function")){this.AutoZoom();return true}break;case"ToggleLogX":this.frame_painter().ToggleLog("x");break;case"ToggleLogY":this.frame_painter().ToggleLog("y");break;case"ToggleLogZ":this.frame_painter().ToggleLog("z");break;case"ToggleStatBox":this.ToggleStat();return true;break}return false};e.prototype.FillToolbar=function(){var h=this.pad_painter();if(!h){return}h.AddButton(a.ToolbarIcons.auto_zoom,"Toggle between unzoom and autozoom-in","ToggleZoom","Ctrl *");h.AddButton(a.ToolbarIcons.arrow_right,"Toggle log x","ToggleLogX","PageDown");h.AddButton(a.ToolbarIcons.arrow_up,"Toggle log y","ToggleLogY","PageUp");if(this.Dimension()>1){h.AddButton(a.ToolbarIcons.arrow_diag,"Toggle log z","ToggleLogZ")}if(this.draw_content){h.AddButton(a.ToolbarIcons.statbox,"Toggle stat box","ToggleStatBox")}};e.prototype.Get3DToolTip=function(i){var h=this.GetHisto(),j={bin:i,name:h.fName||"histo",title:h.fTitle};switch(this.Dimension()){case 1:j.ix=i;j.iy=1;j.value=h.getBinContent(j.ix);j.error=h.getBinError(i);j.lines=this.GetBinTips(i-1);break;case 2:j.ix=i%(this.nbinsx+2);j.iy=(i-j.ix)/(this.nbinsx+2);j.value=h.getBinContent(j.ix,j.iy);j.error=h.getBinError(i);j.lines=this.GetBinTips(j.ix-1,j.iy-1);break;case 3:j.ix=i%(this.nbinsx+2);j.iy=((i-j.ix)/(this.nbinsx+2))%(this.nbinsy+2);j.iz=(i-j.ix-j.iy*(this.nbinsx+2))/(this.nbinsx+2)/(this.nbinsy+2);j.value=this.GetObject().getBinContent(j.ix,j.iy,j.iz);j.error=h.getBinError(i);j.lines=this.GetBinTips(j.ix-1,j.iy-1,j.iz-1);break}return j};e.prototype.CreateContour=function(k,l,o,m){if(k<1){k=a.gStyle.fNumberContours}this.fContour=[];this.colzmin=l;this.colzmax=o;if(this.root_pad().fLogz){if(this.colzmax<=0){this.colzmax=1}if(this.colzmin<=0){if((m===undefined)||(m<=0)){this.colzmin=0.0001*this.colzmax}else{this.colzmin=((m<3)||(m>100))?0.3*m:1}}if(this.colzmin>=this.colzmax){this.colzmin=0.0001*this.colzmax}var q=Math.log(this.colzmin)/Math.log(10),j=Math.log(this.colzmax)/Math.log(10),p=(j-q)/k;this.fContour.push(this.colzmin);for(var h=1;h<k;h++){this.fContour.push(Math.exp((q+p*h)*Math.log(10)))}this.fContour.push(this.colzmax);this.fCustomContour=true}else{if((this.colzmin===this.colzmax)&&(this.colzmin!==0)){this.colzmax+=0.01*Math.abs(this.colzmax);this.colzmin-=0.01*Math.abs(this.colzmin)}var p=(this.colzmax-this.colzmin)/k;for(var h=0;h<=k;h++){this.fContour.push(this.colzmin+p*h)}}var i=this.frame_painter();if(this.Dimension()<3){i.zmin=this.zmin=this.colzmin;i.zmax=this.zmax=this.colzmax}i.fContour=this.fContour;i.fCustomContour=this.fCustomContour;i.colzmin=this.colzmin;i.colzmax=this.colzmax;return this.fContour};e.prototype.GetContour=function(){if(this.fContour){return this.fContour}var h=this.frame_painter();if(h&&h.fContour){this.fContour=h.fContour;this.fCustomContour=h.fCustomContour;this.colzmin=h.colzmin;this.colzmax=h.colzmax;return this.fContour}var j=this.GetHisto(),m=a.gStyle.fNumberContours,i=this.minbin,l=this.maxbin,k=this.minposbin;if(i===l){i=this.gminbin;l=this.gmaxbin;k=this.gminposbin}if(h.zoom_zmin!=h.zoom_zmax){i=h.zoom_zmin;l=h.zoom_zmax}this.fCustomContour=false;return this.CreateContour(m,i,l,k)};e.prototype.FillContextMenu=function(l){var j=this.GetHisto();l.add("header:v7histo::anyname");if(this.draw_content){l.addchk(this.ToggleStat("only-check"),"Show statbox",function(){this.ToggleStat()});if(typeof this.FillHistContextMenu=="function"){this.FillHistContextMenu(l)}}if(this.options.Mode3D){if(l.size()>0){l.add("separator")}var h=this.main_painter()||this,k=this.frame_painter(),i=k;l.addchk(h.tooltip_allowed,"Show tooltips",function(){h.tooltip_allowed=!h.tooltip_allowed});l.addchk(i.enable_highlight,"Highlight bins",function(){i.enable_highlight=!i.enable_highlight;if(!i.enable_highlight&&h.BinHighlight3D&&h.mode3d){h.BinHighlight3D(null)}});if(k&&k.Render3D){l.addchk(h.options.FrontBox,"Front box",function(){h.options.FrontBox=!h.options.FrontBox;k.Render3D()});l.addchk(h.options.BackBox,"Back box",function(){h.options.BackBox=!h.options.BackBox;k.Render3D()})}if(this.draw_content){l.addchk(!this.options.Zero,"Suppress zeros",function(){this.options.Zero=!this.options.Zero;this.RedrawPad()});if((this.options.Lego==12)||(this.options.Lego==14)){l.addchk(this.options.Zscale,"Z scale",function(){this.ToggleColz()});if(this.FillPaletteMenu){this.FillPaletteMenu(l)}}}if(h.control&&typeof h.control.reset==="function"){l.add("Reset camera",function(){h.control.reset()})}}this.FillAttContextMenu(l);if(this.histogram_updated&&this.zoom_changed_interactive){l.add("Let update zoom",function(){this.zoom_changed_interactive=0})}return true};e.prototype.getContourIndex=function(i){var m=this.GetContour();if(this.fCustomContour){var h=0,k=m.length-1,j;if(i<m[0]){return -1}if(i>=m[k]){return k}while(h<k-1){j=Math.round((h+k)/2);if(m[j]>i){k=j}else{h=j}}return h}if(i<this.colzmin){return this.options.Zero?-1:0}if(i===this.colzmin){return((this.colzmin!=0)||!this.options.Zero||this.IsTH2Poly())?0:-1}return Math.floor(0.01+(i-this.colzmin)*(m.length-1)/(this.colzmax-this.colzmin))};e.prototype.getContourColor=function(j,m){var i=this.getContourIndex(j);if(i<0){return null}var l=this.GetContour(),h=this.GetPalette(),k=h.calcColorIndex(i,l.length);return m?k:h.getColor(k)};e.prototype.GetPalette=function(i){if(!this.fPalette||i){var h=this.options.Palette?null:this.canv_painter();this.fPalette=(h&&h.CanvasPalette)?h.CanvasPalette:a.Painter.GetColorPalette(this.options.Palette)}return this.fPalette};e.prototype.FillPaletteMenu=function(j){var i=this.options.Palette;if((i===null)||(i===0)){i=a.gStyle.Palette}function k(l){this.options.Palette=parseInt(l);this.GetPalette(true);this.Redraw()}function h(o,l,m){j.addchk((o===i)||m,"<nobr>"+l+"</nobr>",o,k)}j.add("sub:Palette");h(50,"ROOT 5",(i>=10)&&(i<51));h(51,"Deep Sea");h(52,"Grayscale",(i>0)&&(i<10));h(53,"Dark body radiator");h(54,"Two-color hue");h(55,"Rainbow");h(56,"Inverted dark body radiator");h(57,"Bird",(i>112));h(58,"Cubehelix");h(59,"Green Red Violet");h(60,"Blue Red Yellow");h(61,"Ocean");h(62,"Color Printable On Grey");h(63,"Alpine");h(64,"Aquamarine");h(65,"Army");h(66,"Atlantic");j.add("endsub:")};e.prototype.DrawColorPalette=function(h,j,i){return null};e.prototype.ToggleColz=function(){var h=this.options.Mode3D?(this.options.Lego===12||this.options.Lego===14||this.options.Surf===11||this.options.Surf===12):this.options.Color||this.options.Contour;if(h){this.options.Zscale=!this.options.Zscale;this.DrawColorPalette(this.options.Zscale,false,true)}};e.prototype.ToggleMode3D=function(){this.options.Mode3D=!this.options.Mode3D;if(this.options.Mode3D){if(!this.options.Surf&&!this.options.Lego&&!this.options.Error){if((this.nbinsx>=50)||(this.nbinsy>=50)){this.options.Lego=this.options.Color?14:13}else{this.options.Lego=this.options.Color?12:1}this.options.Zero=false}}this.CopyOptionsToOthers();this.InteractiveRedraw("pad","drawopt")};e.prototype.PrepareColorDraw=function(q){if(!q){q={rounding:true,extra:0,middle:0}}if(q.extra===undefined){q.extra=0}if(q.middle===undefined){q.middle=0}var l=this.GetHisto(),w=this.GetAxis("x"),t=this.GetAxis("y"),o=this.frame_painter(),h=this.Dimension(),m,k,u,s,r,v,p={i1:this.GetSelectIndex("x","left",0-q.extra),i2:this.GetSelectIndex("x","right",1+q.extra),j1:(h===1)?0:this.GetSelectIndex("y","left",0-q.extra),j2:(h===1)?1:this.GetSelectIndex("y","right",1+q.extra),min:0,max:0,sumz:0,xbar1:0,xbar2:1,ybar1:0,ybar2:1};p.grx=new Float32Array(p.i2+1);p.gry=new Float32Array(p.j2+1);if(q.original){p.original=true;p.origx=new Float32Array(p.i2+1);p.origy=new Float32Array(p.j2+1)}if(q.pixel_density){q.rounding=true}for(m=p.i1;m<=p.i2;++m){u=w.GetBinCoord(m+q.middle);if(o.logx&&(u<=0)){p.i1=m+1;continue}if(p.origx){p.origx[m]=u}p.grx[m]=o.grx(u);if(q.rounding){p.grx[m]=Math.round(p.grx[m])}if(q.use3d){if(p.grx[m]<-o.size_xy3d){p.i1=m;p.grx[m]=-o.size_xy3d}if(p.grx[m]>o.size_xy3d){p.i2=m;p.grx[m]=o.size_xy3d}}}if(h===1){p.gry[0]=o.gry(0);p.gry[1]=o.gry(1)}else{for(k=p.j1;k<=p.j2;++k){s=t.GetBinCoord(k+q.middle);if(o.logy&&(s<=0)){p.j1=k+1;continue}if(p.origy){p.origy[k]=s}p.gry[k]=o.gry(s);if(q.rounding){p.gry[k]=Math.round(p.gry[k])}if(q.use3d){if(p.gry[k]<-o.size_xy3d){p.j1=k;p.gry[k]=-o.size_xy3d}if(p.gry[k]>o.size_xy3d){p.j2=k;p.gry[k]=o.size_xy3d}}}}r=l.getBinContent(p.i1+1,p.j1+1);this.maxbin=this.minbin=this.minposbin=null;for(m=p.i1;m<p.i2;++m){for(k=p.j1;k<p.j2;++k){r=l.getBinContent(m+1,k+1);p.sumz+=r;if(q.pixel_density){v=(p.grx[m+1]-p.grx[m])*(p.gry[k]-p.gry[k+1]);if(v<=0){continue}p.max=Math.max(p.max,r);if((r>0)&&((r<p.min)||(p.min===0))){p.min=r}r=r/v}if(this.maxbin===null){this.maxbin=this.minbin=r}else{this.maxbin=Math.max(this.maxbin,r);this.minbin=Math.min(this.minbin,r)}if(r>0){if((this.minposbin===null)||(r<this.minposbin)){this.minposbin=r}}}}this.fContour=null;this.fCustomContour=false;return p};function g(h){e.call(this,h);this.wheel_zoomy=false}g.prototype=Object.create(e.prototype);g.prototype.ConvertTH1K=function(){var i=this.GetObject();if(i.fReady){return}var h=i.fArray;i.fNcells=i.fXaxis.fNbins+2;i.fArray=new Float64Array(i.fNcells);for(var j=0;j<i.fNcells;++j){i.fArray[j]=0}for(var j=0;j<i.fNIn;++j){i.Fill(h[j])}i.fReady=true};g.prototype.ScanContent=function(r){var m=this.GetHisto();if(!m){return}if(!this.nbinsx&&r){r=false}if(!r){this.nbinsx=this.GetAxis("x").fNBins-2;this.nbinsy=0;this.CreateAxisFuncs(false)}var j=this.GetSelectIndex("x","left"),u=this.GetSelectIndex("x","right");if(r){if((j===this.scan_xleft)&&(u===this.scan_xright)){return}}this.scan_xleft=j;this.scan_xright=u;var k=0,h=0,s=0,p=0,q=true,t,l;for(var o=0;o<this.nbinsx;++o){t=m.getBinContent(o+1);p+=t;if((o<j)||(o>=u)){continue}if(t>0){if((h==0)||(t<h)){h=t}}if(q){k=s=t;q=false}l=0;k=Math.min(k,t-l);s=Math.max(s,t+l)}p+=m.getBinContent(0)+m.getBinContent(this.nbinsx+1);this.stat_entries=p;this.hmin=k;this.hmax=s;this.ymin_nz=h;if((this.nbinsx==0)||((Math.abs(k)<1e-300&&Math.abs(s)<1e-300))){this.draw_content=false}else{this.draw_content=true}if(this.draw_content){if(k>=s){if(k==0){this.ymin=0;this.ymax=1}else{if(k<0){this.ymin=2*k;this.ymax=0}else{this.ymin=0;this.ymax=k*2}}}else{var v=(s-k)*0.05;this.ymin=k-v;if((this.ymin<0)&&(k>=0)){this.ymin=0}this.ymax=s+v}}};g.prototype.CountStat=function(p){var j=this.IsTProfile(),t=this.GetHisto(),h=this.GetAxis("x"),k=this.GetSelectIndex("x","left"),z=this.GetSelectIndex("x","right"),x=0,s=0,u=0,r=0,A=0,y,l=0,o=0,v=null,q=null,m=this.frame_painter(),B={name:"histo",meanx:0,meany:0,rmsx:0,rmsy:0,integral:0,entries:this.stat_entries,xmax:0,wmax:0};for(y=k;y<z;++y){l=h.GetBinCoord(y+0.5);if(p&&!p(l)){continue}if(j){o=t.fBinEntries[y+1];r+=t.fArray[y+1];A+=t.fSumw2[y+1]}else{o=t.getBinContent(y+1)}if((v===null)||(o>q)){v=l;q=o}x+=o;s+=o*l;u+=o*l*l}if(!m.IsAxisZoomed("x")&&t.fTsumw){x=t.fTsumw;s=t.fTsumwx;u=t.fTsumwx2}B.integral=x;if(x>0){B.meanx=s/x;B.meany=r/x;B.rmsx=Math.sqrt(Math.abs(u/x-B.meanx*B.meanx));B.rmsy=Math.sqrt(Math.abs(A/x-B.meany*B.meany))}if(v!==null){B.xmax=v;B.wmax=q}return B};g.prototype.FillStatistic=function(m,o,u){if(this.IgnoreStatsFill()){return false}var l=this.CountStat(),r=o%10,s=Math.floor(o/10)%10,q=Math.floor(o/100)%10,t=Math.floor(o/1000)%10,h=Math.floor(o/10000)%10,i=Math.floor(o/100000)%10,j=Math.floor(o/1000000)%10,p=Math.floor(o/10000000)%10,k=Math.floor(o/100000000)%10;m.ClearPave();if(r>0){m.AddText(l.name)}if(this.IsTProfile()){if(s>0){m.AddText("Entries = "+m.Format(l.entries,"entries"))}if(q>0){m.AddText("Mean = "+m.Format(l.meanx));m.AddText("Mean y = "+m.Format(l.meany))}if(t>0){m.AddText("Std Dev = "+m.Format(l.rmsx));m.AddText("Std Dev y = "+m.Format(l.rmsy))}}else{if(s>0){m.AddText("Entries = "+m.Format(l.entries,"entries"))}if(q>0){m.AddText("Mean = "+m.Format(l.meanx))}if(t>0){m.AddText("Std Dev = "+m.Format(l.rmsx))}if(h>0){m.AddText("Underflow = "+m.Format(histo.getBinContent(0),"entries"))}if(i>0){m.AddText("Overflow = "+m.Format(histo.getBinContent(this.nbinsx+1),"entries"))}if(j>0){m.AddText("Integral = "+m.Format(l.integral,"entries"))}if(p>0){m.AddText("Skew = <not avail>")}if(k>0){m.AddText("Kurt = <not avail>")}}return true};g.prototype.DrawBars=function(z,v){this.CreateG(true);var l=this.GetSelectIndex("x","left",-1),F=this.GetSelectIndex("x","right",1),p=this.frame_painter(),m=this,u=this.GetHisto(),j=this.GetAxis("x"),B,D,C,o,k,q,t,s,r,x="",E="",A="",h=(this.options.BarStyle>10)?this.options.BarStyle%10:0;if(h>4){h=4}s=p.swap_xy?0:v;if((this.options.BaseLine!==false)&&!isNaN(this.options.BaseLine)){if(this.options.BaseLine>=p.scale_ymin){s=Math.round(p.gry(this.options.BaseLine))}}for(B=l;B<F;++B){D=j.GetBinCoord(B);C=j.GetBinCoord(B+1);if(p.logx&&(C<=0)){continue}o=Math.round(p.grx(D));k=Math.round(p.grx(C));q=u.getBinContent(B+1);if(p.logy&&(q<p.scale_ymin)){continue}t=Math.round(p.gry(q));r=k-o;o+=Math.round(this.options.fBarOffset/1000*r);r=Math.round(this.options.fBarWidth/1000*r);if(p.swap_xy){x+="M"+s+","+o+"h"+(t-s)+"v"+r+"h"+(s-t)+"z"}else{x+="M"+o+","+t+"h"+r+"v"+(s-t)+"h"+(-r)+"z"}if(h>0){k=o+r;r=Math.round(r*h/10);if(p.swap_xy){E+="M"+s+","+o+"h"+(t-s)+"v"+r+"h"+(s-t)+"z";A+="M"+s+","+k+"h"+(t-s)+"v"+(-r)+"h"+(s-t)+"z"}else{E+="M"+o+","+t+"h"+r+"v"+(s-t)+"h"+(-r)+"z";A+="M"+k+","+t+"h"+(-r)+"v"+(s-t)+"h"+r+"z"}}}if(this.fillatt.empty()){this.fillatt.SetSolidColor("blue")}if(x.length>0){this.draw_g.append("svg:path").attr("d",x).call(this.fillatt.func)}if(E.length>0){this.draw_g.append("svg:path").attr("d",E).call(this.fillatt.func).style("fill",b.rgb(this.fillatt.color).brighter(0.5).toString())}if(A.length>0){this.draw_g.append("svg:path").attr("d",A).call(this.fillatt.func).style("fill",b.rgb(this.fillatt.color).darker(0.5).toString())}};g.prototype.DrawFilledErrors=function(B,A){this.CreateG(true);var o=this.GetSelectIndex("x","left",-1),D=this.GetSelectIndex("x","right",1),s=this.frame_painter(),z=this.GetHisto(),m=this.GetAxis("x"),C,u,p,t,q,w,v,k=[],h=[];for(C=o;C<D;++C){u=m.GetBinCoord(C+0.5);if(s.logx&&(u<=0)){continue}p=Math.round(s.grx(u));t=z.getBinContent(C+1);q=z.getBinError(C+1);if(s.logy&&(t-q<s.scale_ymin)){continue}w=Math.round(s.gry(t+q));v=Math.round(s.gry(t-q));k.push({grx:p,gry:w});h.unshift({grx:p,gry:v})}var r=(this.options.ErrorKind===4)?"bezier":"line",l=a.Painter.BuildSvgPath(r,k),j=a.Painter.BuildSvgPath("L"+r,h);if(this.fillatt.empty()){this.fillatt.setSolidColor("blue")}this.draw_g.append("svg:path").attr("d",l.path+j.path+"Z").style("stroke","none").call(this.fillatt.func)};g.prototype.DrawBins=function(){var h=this.frame_width(),j=this.frame_height(),K=this.options;if(!this.draw_content||(h<=0)||(j<=0)){return this.RemoveDrawG()}this.CheckHistDrawAttributes();if(K.Bar){return this.DrawBars(h,j)}if((K.ErrorKind===3)||(K.ErrorKind===4)){return this.DrawFilledErrors(h,j)}this.CreateG(true);var p=this.GetSelectIndex("x","left",-1),ak=this.GetSelectIndex("x","right",2),G=this.frame_painter(),I=this,v=this.GetHisto(),U=this.GetAxis("x"),V="",ad=false,m,t,s,ag,T,af,S,u,ai,Y,Z,am,z,aq=!K.Zero,o=K.Error,O=K.Mark,k=K.Line,B=K.Text,N=B&&(this.options.TextKind=="E")&&this.IsTProfile()&&v.fBinEntries,R=null,w=null,ah=null,L=null,al="",aj="",C=0,q,E,D,at,ap,ae,ac,ab,ar="",aa,r,X;if(K.ErrorKind===2){if(this.fillatt.empty()){O=true}else{R=""}}else{if(K.Error){w=""}}if(k){L=""}if(O){this.createAttMarker({attr:v,style:this.options.MarkStyle});if(this.markeratt.size>0){ah="";this.markeratt.reset_pos()}else{O=false}}if(B){aa=this.get_color(v.fMarkerColor);r=-1*K.TextAngle;X=20;if((K.fMarkerSize!==1)&&r){X=0.02*j*K.fMarkerSize}if(!r&&!K.TextKind){var ao=h/(ak-p+1);if(ao<3*X){r=270;X=Math.round(ao*0.7)}}this.StartTextDrawing(42,X,this.draw_g,X)}var Q=((ak-p)>3*h);if(K.ErrorKind===1){var M=this.lineatt.width+a.gStyle.fEndErrorSize;al="m0,"+M+"v-"+2*M+"m0,"+M;aj="m"+M+",0h-"+2*M+"m"+M+",0";C=Math.floor((this.lineatt.width-1)/2)}var an=o||O;if(an||B||k){Q=true}for(am=p;am<=ak;++am){ag=U.GetBinCoord(am);if(G.logx&&(ag<=0)){continue}T=Math.round(G.grx(ag));ad=(am===ak);if(ad&&(p<ak)){S=s}else{af=v.getBinContent(am+1);S=Math.round(G.gry(af))}if(V.length===0){z=am;Z=m=t=T;Y=u=ai=s=S;V="M"+t+","+s}else{if(Q){if((T===t)&&!ad){if(S<u){z=am}u=Math.min(u,S);ai=Math.max(ai,S);s=S}else{if(an||B||k){at=v.getBinContent(z+1);if(!aq||(at!==0)){ae=Math.round(G.grx(U.GetBinCoord(z)));ac=Math.round(G.grx(U.GetBinCoord(z+1)));ab=Math.round((ae+ac)/2);q=Math.round(G.gry(at));E=D=20;if(o){ap=v.getBinError(z+1);E=Math.round(q-G.gry(at+ap));D=Math.round(G.gry(at-ap)-q)}if(B){var W=N?v.fBinEntries[z+1]:at;if(W!==0){var A=(W===Math.round(W))?W.toString():a.FFormat(W,a.gStyle.fPaintTextFormat);if(r){this.DrawText({align:12,x:ab,y:Math.round(q-2-X/5),width:0,height:0,rotate:r,text:A,color:aa,latex:0})}else{this.DrawText({align:22,x:Math.round(ae+(ac-ae)*0.1),y:Math.round(q-2-X),width:Math.round((ac-ae)*0.8),height:X,text:A,color:aa,latex:0})}}}if(k&&(L!==null)){L+=((L.length===0)?"M":"L")+ab+","+q}if(an){if((q>=-E)&&(q<=j+D)){if(R!==null){R+="M"+ae+","+(q-E)+"h"+(ac-ae)+"v"+(E+D+1)+"h-"+(ac-ae)+"z"}if(ah!==null){ah+=this.markeratt.create(ab,q)}if(w!==null){if(K.errorX>0){var H=Math.round(ab-(ac-ae)*K.errorX),F=Math.round(ab+(ac-ae)*K.errorX);w+="M"+(H+C)+","+q+al+"h"+(F-H-2*C)+al}w+="M"+ab+","+(q-E+C)+aj+"v"+(E+D-2*C)+aj}}}}}if(!an&&((u!==ai)||(Y!==u))){if(Z!==t){V+="h"+(t-Z)}if(s===u){if(ai!==Y){V+="v"+(ai-Y)}if(u!==ai){V+="v"+(u-ai)}}else{if(u!==Y){V+="v"+(u-Y)}if(ai!==u){V+="v"+(ai-u)}if(s!==ai){V+="v"+(s-ai)}}Z=t;Y=s}if(ad&&(Z!==T)){V+="h"+(T-Z)}z=am;u=ai=s=S;t=T}}else{if((S!==s)||ad){if(T!==t){V+="h"+(T-t)}if(S!==s){V+="v"+(S-s)}s=S;t=T}}}}var J="";if(!this.fillatt.empty()){var P=j+3,l=Math.round(G.gry(0));if(l<=0){P=-3}else{if(l<j){P=l}}J="L"+t+","+P+"L"+m+","+P+"Z";if(V.length>0){V+=J}}if(an||k){if((R!==null)&&(R.length>0)){this.draw_g.append("svg:path").attr("d",R).call(this.fillatt.func)}if((w!==null)&&(w.length>0)){this.draw_g.append("svg:path").attr("d",w).call(this.lineatt.func)}if((L!==null)&&(L.length>0)){if(!this.fillatt.empty()){this.draw_g.append("svg:path").attr("d",K.Fill?(L+J):V).attr("stroke","none").call(this.fillatt.func)}this.draw_g.append("svg:path").attr("d",L).attr("fill","none").call(this.lineatt.func)}if((ah!==null)&&(ah.length>0)){this.draw_g.append("svg:path").attr("d",ah).call(this.markeratt.func)}}else{if(V&&K.Hist){this.draw_g.append("svg:path").attr("d",V).style("stroke-linejoin","miter").call(this.lineatt.func).call(this.fillatt.func)}}if(B){this.FinishTextDrawing(this.draw_g)}};g.prototype.GetBinTips=function(q){var m=[],h=this.GetTipName(),l=this.frame_painter(),k=this.GetHisto(),o=this.GetAxis("x"),j=o.GetBinCoord(q),i=o.GetBinCoord(q+1),p=k.getBinContent(q+1);if(h.length>0){m.push(h)}if(this.options.Error||this.options.Mark){m.push("x = "+l.AxisAsText("x",(j+i)/2));m.push("y = "+l.AxisAsText("y",p));if(this.options.Error){m.push("error x = "+((i-j)/2).toPrecision(4));m.push("error y = "+k.getBinError(q+1).toPrecision(4))}}else{m.push("bin = "+(q+1));if(l.x_kind==="labels"){m.push("x = "+l.AxisAsText("x",j))}else{if(l.x_kind==="time"){m.push("x = "+l.AxisAsText("x",(j+i)/2))}else{m.push("x = ["+l.AxisAsText("x",j)+", "+l.AxisAsText("x",i)+")")}}if(k["$baseh"]){p-=k["$baseh"].getBinContent(q+1)}if(p===Math.round(p)){m.push("entries = "+p)}else{m.push("entries = "+a.FFormat(p,a.gStyle.fStatFormat))}}return m};g.prototype.ProcessTooltip=function(V){if((V===null)||!this.draw_content||this.options.Mode3D){if(this.draw_g!==null){this.draw_g.select(".tooltip_bin").remove()}this.ProvideUserTooltip(null);return null}var h=this.frame_width(),i=this.frame_height(),A=this.frame_painter(),s=this,u=this.GetHisto(),E=this.GetAxis("x"),F=null,z=true,y,K,x,k,I,j,t=2,p=this.GetSelectIndex("x","left",-1),R=this.GetSelectIndex("x","right",2),T=p,O=R;function D(l){var m=E.GetBinCoord(l);return(A.logx&&(m<=0))?null:A.grx(m)}function B(l){var m=u.getBinContent(l+1);if(A.logy&&(m<A.scale_ymin)){return A.swap_xy?-1000:10*i}return Math.round(A.gry(m))}var Q=A.swap_xy?V.y:V.x,P=A.swap_xy?V.x:V.y;while(T<O-1){var S=Math.round((T+O)*0.5),C=D(S);if((C===null)||(C<Q-0.5)){if(A.swap_xy){O=S}else{T=S}}else{if(C>Q+0.5){if(A.swap_xy){T=S}else{O=S}}else{T++;O--}}}F=O=T;y=D(F);if(A.swap_xy){while((T>p)&&(D(T-1)<y+2)){--T}while((O<R)&&(D(O+1)>y-2)){++O}}else{while((T>p)&&(D(T-1)>y-2)){--T}while((O<R)&&(D(O+1)<y+2)){++O}}if(T<O){var N=i;for(var S=T;S<=O;S++){var q=Math.abs(B(S)-P);if(q<N){N=q;F=S}}if(N>i/10){F=Math.round(T+(O-T)/i*P)}y=D(F)}y=Math.round(y);x=Math.round(D(F+1));if(this.options.Bar){var L=x-y;y+=Math.round(this.options.fBarOffset/1000*L);x=y+Math.round(this.options.fBarWidth/1000*L)}if(y>x){var W=y;y=x;x=W}K=Math.round((y+x)/2);I=k=j=B(F);if(this.options.Bar){z=true;t=0;k=Math.round(A.gry(((this.options.BaseLine!==false)&&(this.options.BaseLine>A.scale_ymin))?this.options.BaseLine:A.scale_ymin));if(k>j){var W=k;k=j;j=W}if(!V.touch&&(V.nproc===1)){if((P<k)||(P>j)){F=null}}}else{if(this.options.Error||this.options.Mark||this.options.Line){z=true;var v=3;if(this.markeratt){v=Math.max(v,this.markeratt.GetFullSize())}if(this.options.Error){var H=u.getBinContent(F+1),U=u.getBinError(F+1);k=Math.round(A.gry(H+U));j=Math.round(A.gry(H-U));if((H==0)&&this.IsTProfile()){F=null}var o=(x-y)*this.options.errorX;y=Math.round(K-o);x=Math.round(K+o)}if(x-y<2*v){y=K-v;x=K+v}k=Math.min(k,I-v);j=Math.max(j,I+v);if(!V.touch&&(V.nproc===1)){if((P<k)||(P>j)){F=null}}}else{z=(V.nproc===1)&&(R-p<h);if(z){j=i;if(!this.fillatt.empty()){j=Math.round(A.gry(0));if(j<0){j=0}else{if(j>i){j=i}}if(j<k){var W=k;k=j;j=W}}if(((V.y<k)||(V.y>j))&&!V.touch){F=null}}}}if(F!==null){if((F===p)&&(y>Q+t)){F=null}else{if((F===R-1)&&(x<Q-t)){F=null}else{if((Q<y-t)||(Q>x+t)){F=null}else{if(!this.options.Zero&&(u.getBinContent(F+1)===0)){F=null}}}}}var J=this.draw_g.select(".tooltip_bin");if((F===null)||((j<=0)||(k>=i))){J.remove();this.ProvideUserTooltip(null);return null}var G={name:"histo",title:u.fTitle,x:K,y:I,exact:true,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.fillcoloralt("blue"):"blue",lines:this.GetBinTips(F)};if(V.disabled){J.remove();G.changed=true}else{if(z){if(J.empty()){J=this.draw_g.append("svg:rect").attr("class","tooltip_bin h1bin").style("pointer-events","none")}G.changed=J.property("current_bin")!==F;if(G.changed){J.attr("x",A.swap_xy?k:y).attr("width",A.swap_xy?j-k:x-y).attr("y",A.swap_xy?y:k).attr("height",A.swap_xy?x-y:j-k).style("opacity","0.3").property("current_bin",F)}G.exact=(Math.abs(I-P)<=5)||((P>=k)&&(P<=j));G.menu=true;G.menu_dist=Math.sqrt((K-Q)*(K-Q)+(I-P)*(I-P))}else{var M=this.lineatt.width+3;if(J.empty()){J=this.draw_g.append("svg:circle").attr("class","tooltip_bin").style("pointer-events","none").attr("r",M).call(this.lineatt.func).call(this.fillatt.func)}G.exact=(Math.abs(K-V.x)<=M)&&(Math.abs(I-V.y)<=M);G.menu=G.exact;G.menu_dist=Math.sqrt((K-V.x)*(K-V.x)+(I-V.y)*(I-V.y));G.changed=J.property("current_bin")!==F;if(G.changed){J.attr("cx",K).attr("cy",I).property("current_bin",F)}}}if(this.IsUserTooltipCallback()&&G.changed){this.ProvideUserTooltip({obj:u,name:"histo",bin:F,cont:u.getBinContent(F+1),grx:K,gry:I})}return G};g.prototype.FillHistContextMenu=function(i){i.add("Auto zoom-in",this.AutoZoom);var h=a.getDrawSettings("ROOT."+this.GetObject()._typename,"nosame");i.addDrawMenu("Draw with",h.opts,function(j){if(j==="inspect"){return a.draw(this.divid,this.GetObject(),j)}this.DecodeOptions(j);if(this.options.need_fillcol&&this.fillatt&&this.fillatt.empty()){this.fillatt.Change(5,1001)}this.InteractiveRedraw("pad","drawopt")})};g.prototype.AutoZoom=function(){var l=this.GetSelectIndex("x","left",-1),j=this.GetSelectIndex("x","right",1),m=j-l,h=this.GetHisto(),o=this.GetAxis("x");if(m==0){return}var i=h.getBinContent(l+1);for(var k=l;k<j;++k){i=Math.min(i,h.getBinContent(k+1))}if(i>0){return}while((l<j)&&(h.getBinContent(l+1)<=i)){++l}while((l<j)&&(h.getBinContent(j)<=i)){--j}if((l===j-1)&&(l>2)&&(j<this.nbinsx-2)){--l;++j}if((j-l<m)&&(l<j)){this.frame_painter().Zoom(o.GetBinCoord(l),o.GetBinCoord(j))}};g.prototype.CanZoomIn=function(j,i,h){var k=this.GetAxis("x");if((j=="x")&&(k.FindBin(h,0.5)-k.FindBin(i,0)>1)){return true}if((j=="y")&&(Math.abs(h-i)>Math.abs(this.ymax-this.ymin)*0.000001)){return true}return false};g.prototype.CallDrawFunc=function(k,j){var i=this.frame_painter();if(i&&(i.mode3d!==this.options.Mode3D)){this.options.Mode3D=i.mode3d}var h=this.options.Mode3D?"Draw3D":"Draw2D";this[h](k,j)};g.prototype.Draw2D=function(h){this.Clear3DScene();this.mode3d=false;if(typeof this.DrawColorPalette==="function"){this.DrawColorPalette(false)}if(this.DrawAxes()){this.DrawBins()}a.CallBack(h)};g.prototype.Draw3D=function(i,h){this.mode3d=true;a.AssertPrerequisites("hist3d",function(){this.Draw3D(i,h)}.bind(this))};g.prototype.Redraw=function(h){this.CallDrawFunc(null,h)};function d(k,i,j){var h=new g(i);h.PrepareFrame(k);h.options={Hist:true,Bar:false,Error:false,ErrorKind:-1,errorX:0,Zero:false,Mark:false,Line:false,Fill:false,Lego:0,Surf:0,Text:false,TextAngle:0,TextKind:"",AutoColor:0,fBarOffset:0,fBarWidth:1000,fMarkerSize:1,BaseLine:false,Mode3D:false};h.ScanContent();h.CallDrawFunc(function(){h.DrawingReady()});return h}function f(h){e.call(this,h);this.fContour=null;this.fCustomContour=false;this.fPalette=null;this.wheel_zoomy=true}f.prototype=Object.create(e.prototype);f.prototype.Cleanup=function(){delete this.fCustomContour;delete this.tt_handle;e.prototype.Cleanup.call(this)};f.prototype.Dimension=function(){return 2};f.prototype.ToggleProjection=function(j,i){if(j=="Projections"){j=""}if((typeof j=="string")&&(j.length>1)){i=parseInt(j.substr(1));j=j[0]}if(!i){i=1}if(j&&(this.is_projection==j)){if(this.projection_width===i){j=""}else{this.projection_width=i;return}}delete this.proj_hist;this.is_projection=(this.is_projection===j)?"":j;this.projection_width=i;var h=this.canv_painter();if(h){h.ToggleProjection(this.is_projection,this.RedrawProjection.bind(this))}};f.prototype.RedrawProjection=function(k,j,i,h){};f.prototype.ExecuteMenuCommand=function(i,h){if(e.prototype.ExecuteMenuCommand.call(this,i,h)){return true}if((i.fName=="SetShowProjectionX")||(i.fName=="SetShowProjectionY")){this.ToggleProjection(i.fName[17],h&&parseInt(h)?parseInt(h):1);return true}return false};f.prototype.FillHistContextMenu=function(m){m.add("sub:Projections",this.ToggleProjection);var l=this.is_projection||"";if(l){l+=this.projection_width}var j=["X1","X2","X3","X5","X10","Y1","Y2","Y3","Y5","Y10"];for(var h=0;h<j.length;++h){m.addchk(l==j[h],j[h],j[h],this.ToggleProjection)}m.add("endsub:");m.add("Auto zoom-in",this.AutoZoom);var i=a.getDrawSettings("ROOT."+this.GetObject()._typename,"nosame");m.addDrawMenu("Draw with",i.opts,function(k){if(k==="inspect"){return a.draw(this.divid,this.GetObject(),k)}this.DecodeOptions(k);this.InteractiveRedraw("pad","drawopt")});if(this.options.Color){this.FillPaletteMenu(m)}};f.prototype.ButtonClick=function(h){if(e.prototype.ButtonClick.call(this,h)){return true}switch(h){case"ToggleColor":this.ToggleColor();break;case"ToggleColorZ":this.ToggleColz();break;case"Toggle3D":this.ToggleMode3D();break;default:return false}return true};f.prototype.FillToolbar=function(){e.prototype.FillToolbar.call(this);var h=this.pad_painter();if(h===null){return}if(!this.IsTH2Poly()){h.AddButton(a.ToolbarIcons.th2color,"Toggle color","ToggleColor")}h.AddButton(a.ToolbarIcons.th2colorz,"Toggle color palette","ToggleColorZ");h.AddButton(a.ToolbarIcons.th2draw3d,"Toggle 3D mode","Toggle3D")};f.prototype.ToggleColor=function(){if(this.options.Mode3D){this.options.Mode3D=false;this.options.Color=true}else{this.options.Color=!this.options.Color}this._can_move_colz=true;this.Redraw()};f.prototype.AutoZoom=function(){if(this.IsTH2Poly()){return}var u=this.GetSelectIndex("x","left",-1),s=this.GetSelectIndex("x","right",1),k=this.GetSelectIndex("y","left",-1),h=this.GetSelectIndex("y","right",1),y,w,o=this.GetHisto(),l=this.GetAxis("x"),A=this.GetAxis("y");if((u==s)||(k==h)){return}var t=o.getBinContent(u+1,k+1);for(y=u;y<s;++y){for(w=k;w<h;++w){t=Math.min(t,o.getBinContent(y+1,w+1))}}if(t>0){return}var C=s,x=u,q=h,B=k;for(y=u;y<s;++y){for(w=k;w<h;++w){if(o.getBinContent(y+1,w+1)>t){if(y<C){C=y}if(y>=x){x=y+1}if(w<q){q=w}if(w>=B){B=w+1}}}}var p,r,v,z,m=false;if((C===x-1)&&(C>u+1)&&(x<s-1)){C--;x++}if((q===B-1)&&(q>k+1)&&(B<h-1)){q--;B++}if((C>u||x<s)&&(C<x-1)){p=l.GetBinCoord(C);r=l.GetBinCoord(x);m=true}if((q>k||B<h)&&(q<B-1)){v=A.GetBinCoord(q);z=A.GetBinCoord(B);m=true}if(m){this.frame_painter().Zoom(p,r,v,z)}};f.prototype.ScanContent=function(o){if(o&&this.nbinsx&&this.nbinsy){return}var m,l,k=this.GetHisto();this.nbinsx=this.GetAxis("x").fNBins-2;this.nbinsy=this.GetAxis("y").fNBins-2;this.CreateAxisFuncs(true);if(this.IsTH2Poly()){this.gminposbin=null;this.gminbin=this.gmaxbin=0;for(var q=0,h=k.fBins.arr.length;q<h;++q){var p=k.fBins.arr[q].fContent;if(q===0){this.gminbin=this.gmaxbin=p}if(p<this.gminbin){this.gminbin=p}else{if(p>this.gmaxbin){this.gmaxbin=p}}if(p>0){if((this.gminposbin===null)||(this.gminposbin>p)){this.gminposbin=p}}}}else{this.gminbin=this.gmaxbin=k.getBinContent(1,1);this.gminposbin=null;for(m=0;m<this.nbinsx;++m){for(l=0;l<this.nbinsy;++l){var p=k.getBinContent(m+1,l+1);if(p<this.gminbin){this.gminbin=p}else{if(p>this.gmaxbin){this.gmaxbin=p}}if(p>0){if((this.gminposbin===null)||(this.gminposbin>p)){this.gminposbin=p}}}}}if(this.gminposbin===null){this.gminposbin=this.gmaxbin*0.0001}if(this.options.Axis>0){this.draw_content=false}else{this.draw_content=this.gmaxbin>0}};f.prototype.CountStat=function(t){var v=this.GetObject(),m=0,r=0,E=0,q=0,D=0,K=0,j,G,o,z,M,p=this.frame_painter(),O={name:"histo",entries:0,integral:0,meanx:0,meany:0,rmsx:0,rmsy:0,matrix:[0,0,0,0,0,0,0,0,0],xmax:0,ymax:0,wmax:null};if(this.IsTH2Poly()){var J=v.fBins.arr.length,F,y,C,A,u,x,h,s=this.frame_painter();for(F=0;F<J;++F){y=v.fBins.arr[F];j=1;G=1;if(y.fXmin>s.scale_xmax){j=2}else{if(y.fXmax<s.scale_xmin){j=0}}if(y.fYmin>s.scale_ymax){G=2}else{if(y.fYmax<s.scale_ymin){G=0}}o=z=h=0;A=y.fPoly;x=1;if(A._typename==="TMultiGraph"){x=y.fPoly.fGraphs.arr.length;A=null}for(u=0;u<x;++u){if(!A||(u>0)){A=y.fPoly.fGraphs.arr[u]}for(C=0;C<A.fNpoints;++C){++h;o+=A.fX[C];z+=A.fY[C]}}if(h>1){o=o/h;z=z/h}M=y.fContent;O.entries+=M;O.matrix[G*3+j]+=M;if((j!=1)||(G!=1)){continue}if((t!=null)&&!t(o,z)){continue}if((O.wmax==null)||(M>O.wmax)){O.wmax=M;O.xmax=o;O.ymax=z}m+=M;r+=o*M;E+=z*M;q+=o*o*M;D+=z*z*M;K+=o*z*M}}else{var l=this.GetSelectIndex("x","left"),B=this.GetSelectIndex("x","right"),L=this.GetSelectIndex("y","left"),I=this.GetSelectIndex("y","right"),w,N,k=this.GetAxis("x"),H=this.GetAxis("y");for(w=0;w<=this.nbinsx+1;++w){j=(w<=l)?0:(w>B?2:1);o=k.GetBinCoord(w-0.5);for(N=0;N<=this.nbinsy+1;++N){G=(N<=L)?0:(N>I?2:1);z=H.GetBinCoord(N-0.5);M=v.getBinContent(w,N);O.entries+=M;O.matrix[G*3+j]+=M;if((j!=1)||(G!=1)){continue}if((t!=null)&&!t(o,z)){continue}if((O.wmax==null)||(M>O.wmax)){O.wmax=M;O.xmax=o;O.ymax=z}m+=M;r+=o*M;E+=z*M;q+=o*o*M;D+=z*z*M;K+=o*z*M}}}if(!p.IsAxisZoomed("x")&&!p.IsAxisZoomed("y")&&(v.fTsumw>0)){m=v.fTsumw;r=v.fTsumwx;q=v.fTsumwx2;E=v.fTsumwy;D=v.fTsumwy2;K=v.fTsumwxy}if(m>0){O.meanx=r/m;O.meany=E/m;O.rmsx=Math.sqrt(Math.abs(q/m-O.meanx*O.meanx));O.rmsy=Math.sqrt(Math.abs(D/m-O.meany*O.meany))}if(O.wmax===null){O.wmax=0}O.integral=m;if(v.fEntries>1){O.entries=v.fEntries}return O};f.prototype.FillStatistic=function(p,q,w){if(this.IgnoreStatsFill()){return false}var o=this.CountStat(),t=Math.floor(q%10),u=Math.floor(q/10)%10,s=Math.floor(q/100)%10,v=Math.floor(q/1000)%10,h=Math.floor(q/10000)%10,i=Math.floor(q/100000)%10,k=Math.floor(q/1000000)%10,r=Math.floor(q/10000000)%10,l=Math.floor(q/100000000)%10;p.ClearPave();if(t>0){p.AddText(o.name)}if(u>0){p.AddText("Entries = "+p.Format(o.entries,"entries"))}if(s>0){p.AddText("Mean x = "+p.Format(o.meanx));p.AddText("Mean y = "+p.Format(o.meany))}if(v>0){p.AddText("Std Dev x = "+p.Format(o.rmsx));p.AddText("Std Dev y = "+p.Format(o.rmsy))}if(k>0){p.AddText("Integral = "+p.Format(o.matrix[4],"entries"))}if(r>0){p.AddText("Skewness x = <undef>");p.AddText("Skewness y = <undef>")}if(l>0){p.AddText("Kurt = <undef>")}if((h>0)||(i>0)){var j=o.matrix;p.AddText(""+j[6].toFixed(0)+" | "+j[7].toFixed(0)+" | "+j[7].toFixed(0));p.AddText(""+j[3].toFixed(0)+" | "+j[4].toFixed(0)+" | "+j[5].toFixed(0));p.AddText(""+j[0].toFixed(0)+" | "+j[1].toFixed(0)+" | "+j[2].toFixed(0))}return true};f.prototype.DrawBinsColor=function(u,p){var m=this.GetHisto(),q=this.PrepareColorDraw(),k=[],t=[],s=[],x,y,v,o,l,r;for(o=q.i1;o<q.i2;++o){for(l=q.j1;l<q.j2;++l){r=m.getBinContent(o+1,l+1);x=this.getContourColor(r,true);if(r===0){if(!this.options.Zero){continue}if((x===null)&&this._show_empty_bins){x=0}}if(x===null){continue}y="M"+q.grx[o]+","+q.gry[l+1];if(k[x]===undefined){k[x]=y}else{v="m"+(q.grx[o]-t[x])+","+(q.gry[l+1]-s[x]);k[x]+=(v.length<y.length)?v:y}t[x]=q.grx[o];s[x]=q.gry[l+1];k[x]+="v"+(q.gry[l]-q.gry[l+1])+"h"+(q.grx[o+1]-q.grx[o])+"v"+(q.gry[l+1]-q.gry[l])+"z"}}for(x=0;x<k.length;++x){if(k[x]!==undefined){this.draw_g.append("svg:path").attr("palette-index",x).attr("fill",this.fPalette.getColor(x)).attr("d",k[x])}}return q};f.prototype.BuildContour=function(M,L,ak,E){var G=this.GetHisto(),ad=0,t=this,T=2004,o=2000,W=new Float32Array(2*T),h=new Float32Array(2*T),D=new Int32Array(2*T),X=0,ai,U,aa=[],am,J=0,ac=[0,0,0,0],ab=[0,0,0,0],r=[0,0,0,0],P=[0,0,0,0],al,aj,ah,af,ag,O,l,ae,Q,F,C,O,q;function w(i){for(var j=0;j<L.length;++j){if(i<L[j]){return j-1}}return L.length-1}function u(an,ax,aA,k,y,aw,az,j){var ay=(aA===az),i=ay?(j-k):(az-aA),av=ax+1,x=y-an,ao=X-1,ar=T/2-3+X,m=0,au,aq,ap,at;while(av<=aw&&ao<=ar){at=L[av];ap=at-an;aq=ap/x;au=i*aq;if(ay){W[ao]=aA;h[ao]=k+au}else{W[ao]=aA+au;h[ao]=k}D[ao]=av;m++;ao+=2;av++}return m}var s=M.original?M.origx:M.grx,p=M.original?M.origy:M.gry;for(aj=M.j1;aj<M.j2-1;++aj){ab[1]=ab[0]=(p[aj]+p[aj+1])/2;ab[3]=ab[2]=(p[aj+1]+p[aj+2])/2;for(al=M.i1;al<M.i2-1;++al){r[0]=G.getBinContent(al+1,aj+1);r[1]=G.getBinContent(al+2,aj+1);r[2]=G.getBinContent(al+2,aj+2);r[3]=G.getBinContent(al+1,aj+2);for(ah=0;ah<4;ah++){P[ah]=w(r[ah])}if((P[0]!==P[1])||(P[1]!==P[2])||(P[2]!==P[3])||(P[3]!==P[0])){ac[3]=ac[0]=(s[al]+s[al+1])/2;ac[2]=ac[1]=(s[al+1]+s[al+2])/2;if(r[0]<=r[1]){af=0}else{af=1}if(r[2]<=r[3]){ag=2}else{ag=3}if(r[af]>r[ag]){af=ag}af++;X=1;for(O=1;O<=4;O++){ag=af%4+1;l=u(r[af-1],P[af-1],ac[af-1],ab[af-1],r[ag-1],P[ag-1],ac[ag-1],ab[ag-1]);X+=2*l;af=ag}if(r[0]<=r[1]){af=0}else{af=1}if(r[2]<=r[3]){ag=2}else{ag=3}if(r[af]>r[ag]){af=ag}af++;X=2;for(O=1;O<=4;O++){if(af==1){ag=4}else{ag=af-1}l=u(r[af-1],P[af-1],ac[af-1],ab[af-1],r[ag-1],P[ag-1],ac[ag-1],ab[ag-1]);X+=2*l;af=ag}ae=0;for(O=1;O<=X-5;O+=2){while(D[O-1]!=D[O]){Q=W[O];F=h[O];C=D[O];for(q=O;q<=X-5;q+=2){W[q]=W[q+2];h[q]=h[q+2];D[q]=D[q+2]}W[X-3]=Q;h[X-3]=F;D[X-3]=C;if(ae>o){break}ae++}}if(ae>o){continue}for(O=1;O<=X-2;O+=2){ai=D[O-1];if((ai>=0)&&(ai<L.length)){U=aa[ai];if(!U){U=aa[ai]=a.CreateTPolyLine(T*4,true)}am=U.fLastPoint;if(am<U.fN-2){U.fX[am+1]=Math.round(W[O-1]);U.fY[am+1]=Math.round(h[O-1]);U.fX[am+2]=Math.round(W[O]);U.fY[am+2]=Math.round(h[O]);U.fLastPoint=am+2;J=Math.max(J,U.fLastPoint+1)}else{}}}}}}var S=new Int32Array(L.length),B=0;for(ai=0;ai<L.length;ai++){if(L[ai]>=0){B=ai;break}}ah=0;for(ai=B-1;ai>=0;ai--){S[ah]=ai;ah++}for(ai=B;ai<L.length;ai++){S[ah]=ai;ah++}var Y=new Float32Array(2*J),I=new Float32Array(2*J);for(ah=0;ah<L.length;++ah){ai=S[ah];U=aa[ai];if(!U){continue}var N=ak.calcColorIndex(ai,L.length),R=U.fX,A=U.fY,am=U.fLastPoint+1,Z=0,H,K,v=0,V=0,z;while(true){H=J;K=H+1;Y[H]=R[Z];I[H]=A[Z];Y[K]=R[Z+1];I[K]=A[Z+1];R[Z]=R[Z+1]=v;A[Z]=A[Z+1]=V;while(true){z=0;for(al=2;al<am;al+=2){if((K<2*J-1)&&(R[al]===Y[K])&&(A[al]===I[K])){K++;Y[K]=R[al+1];I[K]=A[al+1];R[al]=R[al+1]=v;A[al]=A[al+1]=V;z++}if((H>0)&&(R[al+1]===Y[H])&&(A[al+1]===I[H])){H--;Y[H]=R[al];I[H]=A[al];R[al]=R[al+1]=v;A[al]=A[al+1]=V;z++}}if(z==0){break}}if((H+1<K)&&(H>=0)){E(N,Y,I,H,K,ai)}Z=0;for(al=2;al<am;al+=2){if(R[al]!==v&&A[al]!==V){Z=al;break}}if(Z===0){break}}}};f.prototype.DrawBinsContour=function(h,r){var p=this.PrepareColorDraw({rounding:false,extra:100,original:this.options.Proj!=0}),v=this.GetContour(),j=this.GetPalette(),s=this,l=this.frame_painter();function k(A,D,x,w){var C="",z=null,B=null,y;for(y=x;y<=w;++y){B=null;switch(s.options.Proj){case 1:B=l.ProjectAitoff2xy(A[y],D[y]);break;case 2:B=l.ProjectMercator2xy(A[y],D[y]);break;case 3:B=l.ProjectSinusoidal2xy(A[y],D[y]);break;case 4:B=l.ProjectParabolic2xy(A[y],D[y]);break}if(B){B.x=l.grx(B.x);B.y=l.gry(B.y)}else{B={x:A[y],y:D[y]}}B.x=Math.round(B.x);B.y=Math.round(B.y);if(!C){C="M"+B.x+","+B.y}else{if((B.x!=z.x)&&(B.y!=z.y)){C+="l"+(B.x-z.x)+","+(B.y-z.y)}else{if(B.x!=z.x){C+="h"+(B.x-z.x)}else{if(B.y!=z.y){C+="v"+(B.y-z.y)}}}}z=B}return C}if(this.options.Contour===14){var t="M0,0h"+h+"v"+r+"h-"+h;if(this.options.Proj){var q=p.j2-p.j1,u=new Float32Array(q*2),o=new Float32Array(q*2);for(var m=0;m<q;++m){u[m]=p.origx[p.i1];o[m]=(p.origy[p.j1]*(m+0.5)+p.origy[p.j2]*(q-0.5-m))/q;u[m+q]=p.origx[p.i2];o[m+q]=(p.origy[p.j2]*(m+0.5)+p.origy[p.j1]*(q-0.5-m))/q}t=k(u,o,0,2*q-1)}this.draw_g.append("svg:path").attr("d",t+"z").style("stroke","none").style("fill",j.calcColor(0,v.length))}this.BuildContour(p,v,j,function(D,y,i,A,z){var C=j.getColor(D),x=C,B=null;switch(s.options.Contour){case 1:break;case 11:x="none";B=new a.TAttLineHandler({color:C});break;case 12:x="none";B=new a.TAttLineHandler({color:1,style:(D%5+1),width:1});break;case 13:x="none";B=s.lineatt;break;case 14:break}var w=s.draw_g.append("svg:path").attr("class","th2_contour").attr("d",k(y,i,A,z)+(x=="none"?"":"z")).style("fill",x);if(B!==null){w.call(B.func)}else{w.style("stroke","none")}});p.hide_only_zeros=true;return p};f.prototype.CreatePolyBin=function(r,v){var l="",i,h=1,k=null;if(v.fPoly._typename=="TMultiGraph"){h=v.fPoly.fGraphs.arr.length}else{k=v.fPoly}for(i=0;i<h;++i){if(!k||(i>0)){k=v.fPoly.fGraphs.arr[i]}var u=k.fNpoints,j,t=k.fX,s=k.fY,o=Math.round(r.grx(t[0])),m=Math.round(r.gry(s[0])),q,p;if((u>2)&&(t[0]==t[u-1])&&(s[0]==s[u-1])){u--}l+="M"+o+","+m;for(j=1;j<u;++j){q=Math.round(r.grx(t[j]));p=Math.round(r.gry(s[j]));if((o!==q)||(m!==p)){if(o===q){l+="v"+(p-m)}else{if(m===p){l+="h"+(q-o)}else{l+="l"+(q-o)+","+(p-m)}}}o=q;m=p}l+="z"}return l};f.prototype.DrawPolyBinsColor=function(q,A){var r=this.GetHisto(),m=this.frame_painter(),D=[],o=[],k,v,s,C,x,z=r.fBins.arr.length;this.fContour=null;this.fCustomContour=false;this.maxbin=this.gmaxbin;this.minbin=this.gminbin;this.minposbin=this.gminposbin;for(x=0;x<z;++x){s=r.fBins.arr[x];k=this.getContourColor(s.fContent,true);if(k===null){continue}if((s.fContent===0)&&!this.options.Zero){continue}if((s.fXmin>m.scale_xmax)||(s.fXmax<m.scale_xmin)||(s.fYmin>m.scale_ymax)||(s.fYmax<m.scale_ymin)){continue}v=this.CreatePolyBin(m,s);if(D[k]===undefined){D[k]=v}else{D[k]+=v}if(this.options.Text){o.push(s)}}for(k=0;k<D.length;++k){if(D[k]){C=this.draw_g.append("svg:path").attr("palette-index",k).attr("fill",this.fPalette.getColor(k)).attr("d",D[k]);if(this.options.Line){C.call(this.lineatt.func)}}}if(o.length>0){var j=this.get_color(r.fMarkerColor),l=-1*this.options.TextAngle,y=this.draw_g.append("svg:g").attr("class","th2poly_text"),p=12;if((r.fMarkerSize!==1)&&l){p=Math.round(0.02*A*r.fMarkerSize)}this.StartTextDrawing(42,p,y,p);for(x=0;x<o.length;++x){s=o[x];var u=Math.round(m.x((s.fXmin+s.fXmax)/2)),t=Math.round(m.y((s.fYmin+s.fYmax)/2)),B="";if(!this.options.TextKind){B=(Math.round(s.fContent)===s.fContent)?s.fContent.toString():a.FFormat(s.fContent,a.gStyle.fPaintTextFormat)}else{if(s.fPoly){B=s.fPoly.fName}if(B==="Graph"){B=""}if(!B){B=s.fNumber}}this.DrawText({align:22,x:u,y:t,rotate:l,text:B,color:j,latex:0,draw_g:y})}this.FinishTextDrawing(y,null)}return{poly:true}};f.prototype.DrawBinsText=function(q,B,E){var s=this.GetHisto(),A,y,r,m,t,G,C,v,u,F,D;if(E===null){E=this.PrepareColorDraw({rounding:false})}var k=this.get_color(s.fMarkerColor),o=-1*this.options.TextAngle,z=this.draw_g.append("svg:g").attr("class","th2_text"),p=20,l=0,x=(this.options.TextKind=="E")&&this.MatchObjectType("TProfile2D")&&(typeof s.getBinEntries=="function");if((s.fMarkerSize!==1)&&o){p=Math.round(0.02*B*s.fMarkerSize)}if(this.options.fBarOffset!==0){l=this.options.fBarOffset*0.001}this.StartTextDrawing(42,p,z,p);for(A=E.i1;A<E.i2;++A){for(y=E.j1;y<E.j2;++y){r=s.getBinContent(A+1,y+1);if((r===0)&&!this._show_empty_bins){continue}t=E.grx[A+1]-E.grx[A];G=E.gry[y]-E.gry[y+1];if(x){r=s.getBinEntries(A+1,y+1)}C=(r===Math.round(r))?r.toString():a.FFormat(r,a.gStyle.fPaintTextFormat);if(o){v=Math.round(E.grx[A]+t*0.5);u=Math.round(E.gry[y+1]+G*(0.5+l));F=0;D=0}else{v=Math.round(E.grx[A]+t*0.1);u=Math.round(E.gry[y+1]+G*(0.1+l));F=Math.round(t*0.8);D=Math.round(G*0.8)}this.DrawText({align:22,x:v,y:u,width:F,height:D,rotate:o,text:C,color:k,latex:0,draw_g:z})}}this.FinishTextDrawing(z,null);E.hide_only_zeros=true;return E};f.prototype.DrawBinsArrow=function(s,H){var v=this.GetHisto(),C="",E,B,u,q,x,O,J,M,z=1e-30,t,r,A,k,K,o,I,G,m,l,y,N,p,L=this.PrepareColorDraw({rounding:false}),F=(L.grx[L.i2]-L.grx[L.i1])/(L.i2-L.i1+1-0.03)/2,D=(L.gry[L.j2]-L.gry[L.j1])/(L.j2-L.j1+1-0.03)/2;for(var M=0;M<2;++M){for(E=L.i1;E<L.i2;++E){for(B=L.j1;B<L.j2;++B){if(E===L.i1){t=v.getBinContent(E+2,B+1)-v.getBinContent(E+1,B+1)}else{if(E===L.i2-1){t=v.getBinContent(E+1,B+1)-v.getBinContent(E,B+1)}else{t=0.5*(v.getBinContent(E+2,B+1)-v.getBinContent(E,B+1))}}if(B===L.j1){r=v.getBinContent(E+1,B+2)-v.getBinContent(E+1,B+1)}else{if(B===L.j2-1){r=v.getBinContent(E+1,B+1)-v.getBinContent(E+1,B)}else{r=0.5*(v.getBinContent(E+1,B+2)-v.getBinContent(E+1,B))}}if(M===0){z=Math.max(z,Math.abs(t),Math.abs(r))}else{A=(L.grx[E]+L.grx[E+1])/2;k=(L.gry[B]+L.gry[B+1])/2;K=F*t/z;o=D*r/z;I=A-K;G=A+K;m=k-o;l=k+o;t=Math.round(G-I);r=Math.round(l-m);if((t!==0)||(r!==0)){C+="M"+Math.round(I)+","+Math.round(m)+"l"+t+","+r;if(Math.abs(t)>5||Math.abs(r)>5){y=Math.sqrt(2/(t*t+r*r));N=Math.round(y*(t+r));p=Math.round(y*(t-r));if((N!==0)&&(p!==0)){C+="l"+(-N)+","+p+"m"+N+","+(-p)+"l"+(-p)+","+(-N)}}}}}}}this.draw_g.append("svg:path").attr("class","th2_arrows").attr("d",C).style("fill","none").call(this.lineatt.func);return L};f.prototype.DrawBinsBox=function(E,L){var G=this.GetHisto(),Q=this.PrepareColorDraw({rounding:false}),C=this.frame_painter();if(C.maxbin===C.minbin){C.maxbin=this.gmaxbin;C.minbin=this.gminbin;C.minposbin=this.gminposbin}if(C.maxbin===C.minbin){C.minbin=Math.min(0,C.maxbin-1)}var v=Math.max(Math.abs(C.maxbin),Math.abs(C.minbin)),p=Math.max(0,C.minbin),K,I,F,x,T="",s="",t="",r="",D,M,o,m,B,H,S,u,l,k,z=1,P=false,J=0,N=1;if(this.root_pad().fLogz&&(v>0)){P=true;N=Math.log(v);if(p>0){J=Math.log(p)}else{if((C.minposbin>=1)&&(C.minposbin<100)){J=Math.log(0.7)}else{J=(C.minposbin>0)?Math.log(0.7*C.minposbin):N-10}}if(J>=N){J=N-10}z=1/(N-J)}else{z=1/(v-p)}for(K=Q.i1;K<Q.i2;++K){for(I=Q.j1;I<Q.j2;++I){F=G.getBinContent(K+1,I+1);x=Math.abs(F);if((x===0)||(x<p)){continue}M=P?((x>0)?Math.log(x)-J:0):(x-p);M=0.5*((M<0)?1:(1-Math.sqrt(M*z)));if(M<0){M=0}S=Q.grx[K+1]-Q.grx[K];u=Q.gry[I]-Q.gry[I+1];o=M*S;m=M*u;B=Math.round(Q.grx[K]+o);H=Math.round(Q.gry[I+1]+m);S=Math.max(Math.round(S-2*o),1);u=Math.max(Math.round(u-2*m),1);T+="M"+B+","+H+"v"+u+"h"+S+"v-"+u+"z";if((F<0)&&(this.options.BoxStyle===10)){s+="M"+B+","+H+"l"+S+","+u+"M"+(B+S)+","+H+"l-"+S+","+u}if((this.options.BoxStyle===11)&&(S>5)&&(u>5)){var R=Math.round(S*0.1),q=Math.round(u*0.1),A="M"+B+","+H+"h"+S+"l"+(-R)+","+q+"h"+(2*R-S)+"v"+(u-2*q)+"l"+(-R)+","+q+"z",y="M"+(B+S)+","+(H+u)+"v"+(-u)+"l"+(-R)+","+q+"v"+(u-2*q)+"h"+(2*R-S)+"l"+(-R)+","+q+"z";if(F<0){r+=A;t+=y}else{t+=A;r+=y}}}}if(T.length>0){var O=this.draw_g.append("svg:path").attr("d",T).call(this.fillatt.func);if((this.options.BoxStyle===11)||!this.fillatt.empty()){O.style("stroke","none")}else{O.call(this.lineatt.func)}}if((t.length>0)&&(this.fillatt.color!=="none")){this.draw_g.append("svg:path").attr("d",t).style("stroke","none").call(this.fillatt.func).style("fill",b.rgb(this.fillatt.color).brighter(0.5).toString())}if(r.length>0){this.draw_g.append("svg:path").attr("d",r).style("stroke","none").call(this.fillatt.func).style("fill",this.fillatt.color==="none"?"red":b.rgb(this.fillatt.color).darker(0.5).toString())}if(s.length>0){var O=this.draw_g.append("svg:path").attr("d",s).style("fill","none");if(this.lineatt.color!=="none"){O.call(this.lineatt.func)}else{O.style("stroke","black")}}return Q};f.prototype.DrawCandle=function(q,z){var r=this.GetHisto(),x=this.GetAxis("y"),B=this.PrepareColorDraw(),m=this.frame_painter(),v,u,o,F,D,C,l,E,p,k,q,G,s="",A="",t;if(r.fMarkerColor===1){r.fMarkerColor=r.fLineColor}this.createAttMarker({attr:r,style:5});this.markeratt.reset_pos();B.candle=[];for(v=B.i1;v<B.i2;++v){D=0;k=0;p=0;for(u=0;u<this.nbinsy;++u){k+=r.getBinContent(v+1,u+1)}G={bin:v,meany:0,m25y:0,p25y:0,median:0,iqr:0,whiskerp:0,whiskerm:0};for(u=0;u<this.nbinsy;++u){l=r.getBinContent(v+1,u+1);t=x.GetBinCoord(u+0.5);if(p/k<0.001&&(p+l)/k>=0.001){G.whiskerm=t}if(p/k<0.25&&(p+l)/k>=0.25){G.m25y=t}if(p/k<0.5&&(p+l)/k>=0.5){G.median=t}if(p/k<0.75&&(p+l)/k>=0.75){G.p25y=t}if(p/k<0.999&&(p+l)/k>=0.999){G.whiskerp=t}p+=l;o=t;D+=l*o}if(p>0){G.meany=D/p}G.iqr=G.p25y-G.m25y;if((G.m25y-1.5*G.iqr)>G.whsikerm){G.whiskerm=G.m25y-1.5*G.iqr}if((G.p25y+1.5*G.iqr)<G.whiskerp){G.whiskerp=G.p25y+1.5*G.iqr}if(m.logy&&(G.whiskerm<=0)){continue}q=B.grx[v+1]-B.grx[v];q*=0.66;E=(B.grx[v+1]+B.grx[v])/2+this.options.fBarOffset/1000*q;if(this.options.fBarWidth>0){q=q*this.options.fBarWidth/1000}G.x1=Math.round(E-q/2);G.x2=Math.round(E+q/2);E=Math.round(E);G.y0=Math.round(m.gry(G.median));s+="M"+G.x1+","+G.y0+"h"+(G.x2-G.x1);G.y1=Math.round(m.gry(G.p25y));G.y2=Math.round(m.gry(G.m25y));s+="M"+G.x1+","+G.y1+"v"+(G.y2-G.y1)+"h"+(G.x2-G.x1)+"v-"+(G.y2-G.y1)+"z";G.yy1=Math.round(m.gry(G.whiskerp));G.yy2=Math.round(m.gry(G.whiskerm));s+="M"+E+","+G.y1+"v"+(G.yy1-G.y1);s+="M"+G.x1+","+G.yy1+"h"+(G.x2-G.x1);s+="M"+E+","+G.y2+"v"+(G.yy2-G.y2);s+="M"+G.x1+","+G.yy2+"h"+(G.x2-G.x1);for(u=0;u<this.nbinsy;++u){l=r.getBinContent(v+1,u+1);t=x.GetBinCoord(u+0.5);if(l>0&&t<G.whiskerm){A+=this.markeratt.create(E,t)}if(l>0&&t>G.whiskerp){A+=this.markeratt.create(E,t)}}B.candle.push(G)}if(s.length>0){this.draw_g.append("svg:path").attr("d",s).call(this.lineatt.func).call(this.fillatt.func)}if(A.length>0){this.draw_g.append("svg:path").attr("d",A).call(this.markeratt.func)}return B};f.prototype.DrawBinsScatter=function(t,J){var y=this.GetHisto(),N=this.PrepareColorDraw({rounding:true,pixel_density:true}),O=[],M=[],L=[],p=[],s=[],r,o,l,I,G,x,q,u,z=1,Q=this.options.ScatCoef*((this.gmaxbin)>2000?2000/this.gmaxbin:1);a.seed(N.sumz);if(Q*N.sumz<100000){this.createAttMarker({attr:y});this.markeratt.reset_pos();var A="",C,v;for(I=N.i1;I<N.i2;++I){q=N.grx[I+1]-N.grx[I];for(G=N.j1;G<N.j2;++G){u=N.gry[G]-N.gry[G+1];x=y.getBinContent(I+1,G+1);v=Math.round(Q*x);if(v<=0){continue}for(C=0;C<v;++C){A+=this.markeratt.create(Math.round(N.grx[I]+q*a.random()),Math.round(N.gry[G+1]+u*a.random()))}}}this.draw_g.append("svg:path").attr("d",A).call(this.markeratt.func);return N}if(this.maxbin>0.7){z=0.7/this.maxbin}var F=Math.round(N.max-N.min);this.CreateContour((F>50)?50:F,this.minposbin,this.maxbin,this.minposbin);for(I=N.i1;I<N.i2;++I){for(G=N.j1;G<N.j2;++G){x=y.getBinContent(I+1,G+1);if((x<=0)||(x<this.minbin)){continue}q=N.grx[I+1]-N.grx[I];u=N.gry[G]-N.gry[G+1];if(q*u<=0){continue}r=this.getContourIndex(x/q/u);if(r<0){continue}o="M"+N.grx[I]+","+N.gry[G+1];if(O[r]===undefined){O[r]=o;p[r]=q;s[r]=u}else{l="m"+(N.grx[I]-M[r])+","+(N.gry[G+1]-L[r]);O[r]+=(l.length<o.length)?l:o;p[r]=Math.max(p[r],q);s[r]=Math.max(s[r],u)}M[r]=N.grx[I];L[r]=N.gry[G+1];O[r]+="v"+u+"h"+q+"v-"+u+"z"}}var P=this.svg_frame().select(".main_layer"),m=P.select("defs");if(m.empty()&&(O.length>0)){m=P.insert("svg:defs",":first-child")}this.createAttMarker({attr:y});for(r=0;r<O.length;++r){if((O[r]!==undefined)&&(r<this.fContour.length)){var E="scatter_"+r,K=m.select("."+E);if(K.empty()){K=m.append("svg:pattern").attr("class",E).attr("id","jsroot_scatter_pattern_"+a.id_counter++).attr("patternUnits","userSpaceOnUse")}else{K.selectAll("*").remove()}var v=Math.round(z*this.fContour[r]*p[r]*s[r]);if(v<1){v=1}var H=new Float32Array(v),D=new Float32Array(v);if(v===1){H[0]=D[0]=0.5}else{for(var B=0;B<v;++B){H[B]=a.random();D[B]=a.random()}}this.markeratt.reset_pos();var A="";for(var B=0;B<v;++B){A+=this.markeratt.create(H[B]*p[r],D[B]*s[r])}K.attr("width",p[r]).attr("height",s[r]).append("svg:path").attr("d",A).call(this.markeratt.func);this.draw_g.append("svg:path").attr("scatter-index",r).attr("fill","url(#"+K.attr("id")+")").attr("d",O[r])}}return N};f.prototype.DrawBins=function(){if(!this.draw_content){return this.RemoveDrawG()}this.CheckHistDrawAttributes();this.CreateG(true);var i=this.frame_width(),j=this.frame_height(),k=null;if(this.IsTH2Poly()){k=this.DrawPolyBinsColor(i,j)}else{if(this.options.Scat){k=this.DrawBinsScatter(i,j)}else{if(this.options.Color){k=this.DrawBinsColor(i,j)}else{if(this.options.Box){k=this.DrawBinsBox(i,j)}else{if(this.options.Arrow){k=this.DrawBinsArrow(i,j)}else{if(this.options.Contour>0){k=this.DrawBinsContour(i,j)}else{if(this.options.Candle){k=this.DrawCandle(i,j)}}}}}}}if(this.options.Text){k=this.DrawBinsText(i,j,k)}if(!k){k=this.DrawBinsScatter(i,j)}this.tt_handle=k};f.prototype.GetBinTips=function(o,m){var k=[],h=this.frame_painter(),r=this.GetAxis("y"),p=this.GetAxis("y"),l=this.GetHisto(),q=l.getBinContent(o+1,m+1);k.push(this.GetTipName()||"histo<2>");if(h.x_kind=="labels"){k.push("x = "+h.AxisAsText("x",r.GetBinCoord(o)))}else{k.push("x = ["+h.AxisAsText("x",r.GetBinCoord(o))+", "+h.AxisAsText("x",r.GetBinCoord(o+1))+")")}if(h.y_kind=="labels"){k.push("y = "+h.AxisAsText("y",p.GetBinCoord(m)))}else{k.push("y = ["+h.AxisAsText("y",p.GetBinCoord(m))+", "+h.AxisAsText("y",p.GetBinCoord(m+1))+")")}k.push("bin = "+o+", "+m);if(l.$baseh){q-=l.$baseh.getBinContent(o+1,m+1)}if(q===Math.round(q)){k.push("entries = "+q)}else{k.push("entries = "+a.FFormat(q,a.gStyle.fStatFormat))}return k};f.prototype.GetCandleTips=function(j){var i=[],h=this.frame_painter(),k=this.GetAxis("y");i.push(this.GetTipName()||"histo");i.push("x = "+h.AxisAsText("x",k.GetBinCoord(j.bin)));i.push("mean y = "+a.FFormat(j.meany,a.gStyle.fStatFormat));i.push("m25 = "+a.FFormat(j.m25y,a.gStyle.fStatFormat));i.push("p25 = "+a.FFormat(j.p25y,a.gStyle.fStatFormat));return i};f.prototype.ProvidePolyBinHints=function(l,h,r){var m=this.GetHisto(),s=m.fBins.arr[l],p=this.frame_painter(),q=s.fPoly.fName,t=[],o=0;if(q==="Graph"){q=""}if(q.length===0){q=s.fNumber}if((h===undefined)&&(r===undefined)){h=r=0;var k=s.fPoly,j=1;if(k._typename==="TMultiGraph"){j=s.fPoly.fGraphs.arr.length;k=null}for(var i=0;i<j;++i){if(!k||(i>0)){k=s.fPoly.fGraphs.arr[i]}for(n=0;n<k.fNpoints;++n){++o;h+=k.fX[n];r+=k.fY[n]}}if(o>1){h=h/o;r=r/o}}t.push(this.GetTipName()||"histo");t.push("x = "+p.AxisAsText("x",h));t.push("y = "+p.AxisAsText("y",r));if(o>0){t.push("npnts = "+o)}t.push("bin = "+q);if(s.fContent===Math.round(s.fContent)){t.push("content = "+s.fContent)}else{t.push("content = "+a.FFormat(s.fContent,a.gStyle.fStatFormat))}return t};f.prototype.ProcessTooltip=function(N){if(!N||!this.draw_content||!this.draw_g||!this.tt_handle||this.options.Proj){if(this.draw_g!==null){this.draw_g.select(".tooltip_bin").remove()}this.ProvideUserTooltip(null);return null}var x=this.GetHisto(),J=this.tt_handle,G,M=this.draw_g.select(".tooltip_bin");if(J.poly){var u=this.frame_painter(),s,r,m=-1;if(u.grx===u.x){s=u.x.invert(N.x)}if(u.gry===u.y){r=u.y.invert(N.y)}if((s!==undefined)&&(r!==undefined)){var G,I=x.fBins.arr.length,z;for(G=0;(G<I)&&(m<0);++G){z=x.fBins.arr[G];if((s<z.fXmin)||(s>z.fXmax)||(r<z.fYmin)||(r>z.fYmax)){continue}if((z.fContent===0)&&!this.options.Zero){continue}var C=z.fPoly,A=1;if(C._typename==="TMultiGraph"){A=z.fPoly.fGraphs.arr.length;C=null}for(var v=0;v<A;++v){if(!C||(v>0)){C=z.fPoly.fGraphs.arr[v]}if(C.IsInside(s,r)){m=G;break}}}}if(m<0){M.remove();this.ProvideUserTooltip(null);return null}var O={name:"histo",title:x.fTitle||"title",x:N.x,y:N.y,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.fillcoloralt("blue"):"blue",exact:true,menu:true,lines:this.ProvidePolyBinHints(m,s,r)};if(N.disabled){M.remove();O.changed=true}else{if(M.empty()){M=this.draw_g.append("svg:path").attr("class","tooltip_bin h1bin").style("pointer-events","none")}O.changed=M.property("current_bin")!==m;if(O.changed){M.attr("d",this.CreatePolyBin(u,z)).style("opacity","0.7").property("current_bin",m)}}if(this.IsUserTooltipCallback()&&O.changed){this.ProvideUserTooltip({obj:x,name:x.fName||"histo",bin:m,cont:z.fContent,grx:N.x,gry:N.y})}return O}else{if(J.candle){var B;for(G=0;G<J.candle.length;++G){B=J.candle[G];if((B.x1<=N.x)&&(N.x<=B.x2)&&(B.yy1<=N.y)&&(N.y<=B.yy2)){break}}if(G>=J.candle.length){M.remove();this.ProvideUserTooltip(null);return null}var O={name:x.fName||"histo",title:x.fTitle||"title",x:N.x,y:N.y,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.fillcoloralt("blue"):"blue",lines:this.GetCandleTips(B),exact:true,menu:true};if(N.disabled){M.remove();O.changed=true}else{if(M.empty()){M=this.draw_g.append("svg:rect").attr("class","tooltip_bin h1bin").style("pointer-events","none")}O.changed=M.property("current_bin")!==G;if(O.changed){M.attr("x",B.x1).attr("width",B.x2-B.x1).attr("y",B.yy1).attr("height",B.yy2-B.yy1).style("opacity","0.7").property("current_bin",G)}}if(this.IsUserTooltipCallback()&&O.changed){this.ProvideUserTooltip({obj:x,name:x.fName||"histo",bin:G+1,cont:B.median,binx:G+1,biny:1,grx:N.x,gry:N.y})}return O}}var G,F,w=0,t=null;for(G=J.i1;G<J.i2;++G){if((N.x>=J.grx[G])&&(N.x<=J.grx[G+1])){break}}for(F=J.j1;F<J.j2;++F){if((N.y>=J.gry[F+1])&&(N.y<=J.gry[F])){break}}if((G<J.i2)&&(F<J.j2)){w=x.getBinContent(G+1,F+1);if(this.is_projection){t=0}else{if(J.hide_only_zeros){t=(w===0)&&!this._show_empty_bins?null:0}else{t=this.getContourColor(w,true);if((t===null)&&(w===0)&&this._show_empty_bins){t=0}}}}if(t===null){M.remove();this.ProvideUserTooltip(null);return null}var O={name:x.fName||"histo",title:x.fTitle||"title",x:N.x,y:N.y,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.fillcoloralt("blue"):"blue",lines:this.GetBinTips(G,F),exact:true,menu:true};if(this.options.Color){O.color2=this.GetPalette().getColor(t)}if(N.disabled&&!this.is_projection){M.remove();O.changed=true}else{if(M.empty()){M=this.draw_g.append("svg:rect").attr("class","tooltip_bin h1bin").style("pointer-events","none")}var E=G,D=G+1,l=F,k=F+1,K=J.grx[E],H=J.grx[D],q=J.gry[k],o=J.gry[l],y=G*10000+F;if(this.is_projection=="X"){K=0;H=this.frame_width();if(this.projection_width>1){var L=(this.projection_width-1)/2;if(k+L>=J.j2){k=Math.min(Math.round(k+L),J.j2);l=Math.max(k-this.projection_width,J.j1)}else{l=Math.max(Math.round(l-L),J.j1);k=Math.min(l+this.projection_width,J.j2)}}q=J.gry[k];o=J.gry[l];y=l*777+k*333}else{if(this.is_projection=="Y"){q=0;o=this.frame_height();if(this.projection_width>1){var L=(this.projection_width-1)/2;if(D+L>=J.i2){D=Math.min(Math.round(D+L),J.i2);E=Math.max(D-this.projection_width,J.i1)}else{E=Math.max(Math.round(E-L),J.i1);D=Math.min(E+this.projection_width,J.i2)}}K=J.grx[E],H=J.grx[D],y=E*777+D*333}}O.changed=M.property("current_bin")!==y;if(O.changed){M.attr("x",K).attr("width",H-K).attr("y",q).attr("height",o-q).style("opacity","0.7").property("current_bin",y)}if(this.is_projection&&O.changed){this.RedrawProjection(E,D,l,k)}}if(this.IsUserTooltipCallback()&&O.changed){this.ProvideUserTooltip({obj:x,name:x.fName||"histo",bin:x.getBin(G+1,F+1),cont:w,binx:G+1,biny:F+1,grx:N.x,gry:N.y})}return O};f.prototype.CanZoomIn=function(j,i,h){if(j=="z"){return true}var k=this.GetAxis(j);return(k.FindBin(h,0.5)-k.FindBin(i,0)>1)};f.prototype.Draw2D=function(i,h){this.mode3d=false;this.Clear3DScene();if(this.DrawAxes()){}this.DrawBins();a.CallBack(i)};f.prototype.Draw3D=function(i,h){this.mode3d=true;a.AssertPrerequisites("hist3d",function(){this.Draw3D(i,h)}.bind(this))};f.prototype.CallDrawFunc=function(k,j){var i=this.frame_painter();if(this.options.Mode3D!==i.mode3d){this.options.Mode3D=i.mode3d}var h=this.options.Mode3D?"Draw3D":"Draw2D";this[h](k,j)};f.prototype.Redraw=function(h){this.CallDrawFunc(null,h)};function c(k,j,i){var h=new f(j);h.PrepareFrame(k);h.options={Hist:false,Bar:false,Error:false,ErrorKind:-1,errorX:0,Zero:false,Mark:false,Line:false,Fill:false,Lego:0,Surf:0,Text:true,TextAngle:0,TextKind:"",fBarOffset:0,fBarWidth:1000,BaseLine:false,Mode3D:false,AutoColor:0,Color:false,Scat:false,ScatCoef:1,Candle:"",Box:false,BoxStyle:0,Arrow:false,Contour:0,Proj:0};if(j.fOpts.fStyle.fIdx==1){h.options.Box=true}else{h.options.Color=true}h.DecodeOptions(i);if(h.IsTH2Poly()){if(h.options.Mode3D){h.options.Lego=12}else{if(!h.options.Color){h.options.Color=true}}}h._show_empty_bins=false;h._can_move_colz=true;h.ScanContent();h.CallDrawFunc(function(){h.DrawingReady()});return h}a.v7.THistPainter=e;a.v7.TH1Painter=g;a.v7.TH2Painter=f;a.v7.drawHist1=d;a.v7.drawHist2=c;return a}));